# 微信公众号文章下载器 - 项目结构与改动总结

## 项目概述

微信公众号文章下载器是一个用于自动下载微信公众号文章并转换为Markdown格式的工具，包含浏览器扩展和本地服务组件。

## 当前项目结构

### 核心组件

- **simple_server.py**: 轻量级HTTP服务器，替代原Flask服务
- **tray_app.py**: 新增的系统托盘应用，提供GUI界面管理服务
- **install.py**: 安装脚本，用于安装依赖、配置自启动和创建快捷方式
- **download_wechat_article.py**: 处理文章下载和转换
- **get_and_clean_url.py**: 处理URL获取和清理

### 浏览器扩展

- **web_extension/**: 包含浏览器扩展相关文件
  - manifest.json: 扩展配置文件
  - popup.html/js: 扩展界面和脚本
  - icons/: 扩展图标


### 用户流程：
- 用户点击浏览器插件
- 插件将URL发送到本地服务
- 本地服务接收到消息后立即响应"已推送下载"
- 然后服务后台异步处理URL并运行脚本
- 服务只需在处理期间运行15分钟后可关闭
关键点：
- 服务可以是按需启动的，不需要一直运行
- 用户体验强调即时反馈，不需等待处理完成
- 处理过程是异步的

### 历史优化

1. **用户体验改进**:
   - 从命令行操作升级到GUI界面
   - 系统托盘图标提供直观操作
   - 一目了然的服务状态指示
   - 无需手动启动命令行窗口

2. **技术优化**:
   - 从Flask服务转为标准库http.server
   - 按需启动和停止服务
   - 更少的依赖要求
   - 更高效的资源利用

3. **跨平台兼容性**:
   - 支持Windows和macOS
   - 支持Python 3.9-3.12


## 第二轮优化

### 界面与交互优化

1. **托盘菜单优化**:
   - 简化托盘菜单，只保留退出选项
   - 实现tray app超轻量级异步菜单显示机制，为了显著提升右键菜单响应速度
   - 立即显示的退出操作

2. **自动化管理**:
   - 应用启动时自动启动服务
   - 后台异步处理服务状态
   - 退出时在后台自动停止服务

3. **灵活安装选项**:
   - 桌面快捷方式创建改为可选项
   - 添加自定义图标支持
   - 支持ICO图标格式替代PNG

### 技术问题修复

1. **应用稳定性**:
   - 修复类初始化顺序问题
   - 优化信号连接与断开异常处理
   - 避免UI线程阻塞
   - 增强异常处理机制

## 待测试功能

1. **系统托盘应用**:
   - 托盘图标正确显示
   - 菜单选项正常工作
   - 服务状态监控准确

2. **服务管理**:
   - 服务正常启动和停止
   - 超时自动关闭功能
   - 端口占用检测

3. **自启动配置**:
   - Windows和macOS自启动设置
   - 兼容旧版本自启动配置

4. **浏览器扩展兼容性**:
   - 与新服务的通信
   - Chrome和Edge适配
   - 设置参数传递

5. **安装流程**:
   - 依赖安装
   - 桌面快捷方式创建
   - Python版本兼容性检查

## 使用方法

1. 运行安装:
   ```
   python install.py
   ```

2. 点击桌面快捷方式或开机自启动托盘应用

3. 通过系统托盘图标管理服务:
   - 退出应用同时停止服务
